<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multi-path Pathfinder · Pathfinder.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://sethaxen.github.io/Pathfinder.jl/multipathfinder/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Pathfinder.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../pathfinder/">Single-path Pathfinder</a></li><li class="is-active"><a class="tocitem" href>Multi-path Pathfinder</a><ul class="internal"><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Multi-path Pathfinder</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multi-path Pathfinder</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sethaxen/Pathfinder.jl/blob/master/docs/src/multipathfinder.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Multi-path-Pathfinder"><a class="docs-heading-anchor" href="#Multi-path-Pathfinder">Multi-path Pathfinder</a><a id="Multi-path-Pathfinder-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-path-Pathfinder" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="Pathfinder.multipathfinder" href="#Pathfinder.multipathfinder"><code>Pathfinder.multipathfinder</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">multipathfinder(
    logp,
    ∇logp,
    θ₀s::AbstractVector{AbstractVector{&lt;:Real}},
    ndraws::Int;
    kwargs...
)</code></pre><p>Filter samples from a mixture of multivariate normal distributions fit using <code>pathfinder</code>.</p><p>For <code>n=length(θ₀s)</code>, <code>n</code> parallel runs of pathfinder produce <code>n</code> multivariate normal approximations of the posterior. These are combined to a mixture model with uniform weights.</p><p>Draws from the components are then resampled with replacement. If <code>importance=true</code>, then Pareto smoothed importance resampling is used, so that the resulting draws better approximate draws from the target distribution.</p><p><strong>Arguments</strong></p><ul><li><code>logp</code>: a callable that computes the log-density of the target distribution.</li><li><code>∇logp</code>: a callable that computes the gradient of <code>logp</code>.</li><li><code>θ₀s</code>: vector of initial points from which each optimization will begin</li><li><code>ndraws</code>: number of approximate draws to return</li></ul><p><strong>Keywords</strong></p><ul><li><code>ndraws_per_run::Int=5</code>: The number of draws to take for each component before resampling.</li><li><code>importance::Bool=true</code>: Perform Pareto smoothed importance resampling of draws.</li></ul><p><strong>Returns</strong></p><ul><li><code>q::Distributions.MixtureModel</code>: Uniformly weighted mixture of ELBO-maximizing   multivariate normal distributions</li><li><code>ϕ::Vector{&lt;:AbstractVector{&lt;:Real}}</code>: <code>ndraws</code> approxiate draws from target distribution</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sethaxen/Pathfinder.jl/blob/3502ea3bff2943cc4205e7ddd3b946da6516150d/src/multipath.jl#L1-L33">source</a></section></article><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><p>Especially for complicated target distributions, it&#39;s more useful to run multi-path Pathfinder. One difficult distribution to sample is Neal&#39;s funnel:</p><p class="math-container">\[\tau \sim \mathrm{Normal}(0, 3)\\
\beta_i \sim \mathrm{Normal}(0, e^{\tau/2})\]</p><p>Such funnel geometries appear in other models and typically frustrate MCMC sampling. Multi-path Pathfinder can&#39;t sample the funnel well, but it can quickly give us draws that can help us diagnose that we have a funnel.</p><p>In this example, we draw from a 100-dimensional funnel and visualize 2 dimensions:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using ForwardDiff, Pathfinder, Plots, Random</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; plotly()</code><code class="nohighlight hljs ansi" style="display:block;">[ Info: For saving to png with the Plotly backend PlotlyBase has to be installed.
Plots.PlotlyBackend()</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; Random.seed!(42)</code><code class="nohighlight hljs ansi" style="display:block;">MersenneTwister(42)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; function logp(x)
           n = length(x)
           τ = x[1]
           β = view(x, 2:n)
           return ((τ / 3)^2 + (n - 1) * τ + sum(b -&gt; abs2(b * exp(-τ / 2)), β)) / -2
       end</code><code class="nohighlight hljs ansi" style="display:block;">logp (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ∇logp(x) = ForwardDiff.gradient(logp, x);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; dim = 100;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ndraws = 1_000;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; nruns = 20;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; θ₀s = collect.(eachcol(rand(dim, nruns) .* 20 .- 10)); # θ₀ ~ Uniform(-10, 10)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @time q, ϕ = multipathfinder(logp, ∇logp, θ₀s, ndraws; ndraws_per_run=ndraws ÷ nruns);</code><code class="nohighlight hljs ansi" style="display:block;">[ Info: Optimized for 795 iterations. Maximum ELBO of 83.18 reached at iteration 9.
[ Info: Optimized for 789 iterations. Maximum ELBO of 66.34 reached at iteration 19.
[ Info: Optimized for 794 iterations. Maximum ELBO of 43.62 reached at iteration 13.
[ Info: Optimized for 788 iterations. Maximum ELBO of 42.76 reached at iteration 19.
[ Info: Optimized for 791 iterations. Maximum ELBO of 88.86 reached at iteration 7.
[ Info: Optimized for 800 iterations. Maximum ELBO of 78.79 reached at iteration 11.
[ Info: Optimized for 837 iterations. Maximum ELBO of 88.53 reached at iteration 6.
[ Info: Optimized for 782 iterations. Maximum ELBO of 85.97 reached at iteration 14.
[ Info: Optimized for 796 iterations. Maximum ELBO of 85.91 reached at iteration 11.
[ Info: Optimized for 793 iterations. Maximum ELBO of 82.26 reached at iteration 11.
[ Info: Optimized for 783 iterations. Maximum ELBO of 85.9 reached at iteration 6.
[ Info: Optimized for 764 iterations. Maximum ELBO of 85.88 reached at iteration 5.
[ Info: Optimized for 40 iterations. Maximum ELBO of 83.1 reached at iteration 11.
[ Info: Optimized for 584 iterations. Maximum ELBO of 82.9 reached at iteration 10.
[ Info: Optimized for 789 iterations. Maximum ELBO of 7.05 reached at iteration 8.
[ Info: Optimized for 898 iterations. Maximum ELBO of 79.3 reached at iteration 26.
[ Info: Optimized for 794 iterations. Maximum ELBO of 89.23 reached at iteration 16.
[ Info: Optimized for 804 iterations. Maximum ELBO of 80.61 reached at iteration 13.
[ Info: Optimized for 800 iterations. Maximum ELBO of 65.81 reached at iteration 13.
[ Info: Optimized for 800 iterations. Maximum ELBO of 87.29 reached at iteration 13.
┌ Warning: Pareto k statistic exceeded 0.7. Resulting importance sampling estimates are likely to be unstable.
└ @ PSIS ~/.julia/packages/PSIS/KhMUf/src/PSIS.jl:100
 14.924871 seconds (31.00 M allocations: 2.763 GiB, 5.49% gc time, 0.03% compilation time)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; typeof(q)</code><code class="nohighlight hljs ansi" style="display:block;">Distributions.MixtureModel{Distributions.Multivariate, Distributions.Continuous, Distributions.MvNormal{Float64, Pathfinder.WoodburyPDMat{Float64, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, Matrix{Float64}, Matrix{Float64}, LinearAlgebra.Diagonal{Float64, Vector{Float64}}, LinearAlgebra.QRCompactWYQ{Float64, Matrix{Float64}}, LinearAlgebra.UpperTriangular{Float64, Matrix{Float64}}}, Vector{Float64}}, Distributions.Categorical{Float64, Vector{Float64}}}</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; τ_approx = first.(ϕ);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; β₁_approx = getindex.(ϕ, 2);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; τ = randn(ndraws) * 3;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; β₁ = @. randn() * exp(τ / 2);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; scatter(β₁, τ; msw=0, ms=2, alpha=0.1, label=&quot;Exact&quot;);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; scatter!(β₁_approx, τ_approx;
               msw=0, ms=2, alpha=0.5, xlims=(-15, 15), ylims=(-15, 15),
               label=&quot;multi-path Pathfinder&quot;, xlabel=&quot;β₁&quot;, ylabel=&quot;τ&quot;, legend=true)</code><code class="nohighlight hljs ansi" style="display:block;">Plot{Plots.PlotlyBackend() n=2}</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../pathfinder/">« Single-path Pathfinder</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Saturday 30 October 2021 23:41">Saturday 30 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
